{
    "device_alias": {
        "Play": "Play",
        "Virus": "Uno MIDI",
        "Uc33": "Uno MIDI"
    },
    "scales": {
        "pentatonic_minor": [0, 3, 5, 7, 10]
    },
    "input_filter": [
        {
            "_comment": "INICIALIZACION",
            "version": 0,
            "output": [
                {"var_1": 1}, {"var_9": 1},
                {"var_16": 0}, {"var_17": 1}, {"var_18": 15},
                {"var_19": "pentatonic_minor"},
                {"var_21": 60}, 
                {"var_24": 0.75}, 
                {"var_29": 0},   
                {"var_30": 0},   
                {"var_31": 0}    
            ]
        },
        {
            "_comment": "CONTROL DE PROBABILIDAD DEL PULSO (var_24) con CC#12 en Ch9 de Uc33",
            "device_in": "Uc33", "event_in": "cc", "ch_in": 8, "value_1_in": 12, 
            "output": [
                {"var_24": "value_2_in / 127.0"} 
            ]
        },
        {
            "_comment": "PROCESADOR DE CLOCK: Actualiza var_29 (clocks) y var_30 (beats)",
            "device_in": "Play",
            "event_in": "clock",
            "output": [
                {"var_29": "(var_29 + 1) % 24"},
                {"var_30": "var_30 + 1 if var_29 == 0 else var_30"}
            ]
        },
        {
            "_comment": "ACTUALIZAR NOTA BASE DEL PULSO (var_31) CADA 4 BEATS USANDO var_30",
            "device_in": "Play", 
            "event_in": "clock", 
            "output": [
                {
                    "var_31": "var_21 if (var_30 % 12 < 4) else (var_21 + 3 if (var_30 % 12 < 8) else var_21 + 5)"
                }
            ]
        },
        {
            "_comment": "GENERADOR DE PULSO RÍTMICO PROBABILÍSTICO EN CH1 DEL VIRUS",
            "device_in": "Play",
            "event_in": "clock", 
            "output": [
                {
                    "device_out": "Virus",
                    "channel_out": "1 if var_1 == 1 and var_9 == 1 and (var_29 % 6 == 0) and prob(var_24) == 1 else 15",
                    "event_out": "note_on",
                    "value_1_out": {
                        "scale_notes": {
                            "scale_value": "random( (var_31 + var_16) - var_17, (var_31 + var_16) + var_17 )",
                            "scale_root": "var_21", 
                            "scale_type": "var_19"
                        }
                    },
                    "value_2_out": "100 + rand_val(0 - var_18, var_18)"
                }
            ]
        },
        {
            "_comment": "OPCIONAL: Passthrough de Start/Stop si lo necesitas",
            "device_in": "Play",
            "event_in": ["start", "stop"],
            "output": [
                { "device_out": "Virus" }
            ]
        }
    ]
}